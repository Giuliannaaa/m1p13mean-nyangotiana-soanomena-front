<div *ngIf="produit">
  <h1>Achat du produit</h1>

  <p><strong>Produit :</strong> {{ nom_prod }}</p>
  <p><strong>Prix unitaire :</strong> {{ prix_unitaire }} Ar</p>

  <!-- Afficher la promotion si active -->
  <div *ngIf="promotionActive" style="padding: 10px; margin: 10px 0; border-radius: 5px;">
    <p style="color: #155724; font-weight: bold;">
      Promotion active : 
      <span *ngIf="promotionActive.type_prom === 'POURCENTAGE'">
        -{{ promotionActive.montant }}%
      </span>
      <span *ngIf="promotionActive.type_prom === 'MONTANT'">
        -{{ promotionActive.montant }} Ar
      </span>
    </p>
  </div>

  <form (ngSubmit)="submitAchat()">
    <div>
      <label>Quantité :</label>
      <input
        type="number"
        min="1"
        [(ngModel)]="quantity"
        name="quantity"
        (input)="calculateTotal()"
        required
      />
    </div>

    <!-- Option de livraison -->
    <div *ngIf="produit.livraison.disponibilite" style="margin: 15px 0; padding: 10px; border-radius: 5px;">
      <label style="display: flex; align-items: center; cursor: pointer;">
        <input
          type="checkbox"
          [(ngModel)]="avec_livraison"
          name="avec_livraison"
          (change)="toggleLivraison()"
          style="margin-right: 10px;"
          checked
        />
        <span>
          Livraison disponible ({{ produit.livraison.frais }} Ar)
        </span>
      </label>
    </div>

    <!-- Récapitulatif des prix -->
    <div style="margin: 20px 0; padding: 15px; border-radius: 5px;">
      <p><strong>Sous-total :</strong> {{ total_achat }} Ar</p>
      
      <p *ngIf="reduction > 0" style="color: green;">
        <strong>Réduction :</strong> -{{ reduction }} Ar
      </p>
      
      <p *ngIf="avec_livraison" style="color: #007bff;">
        <strong>Frais de livraison :</strong> +{{ frais_livraison }} Ar
      </p>
      
      <hr style="margin: 10px 0;">
      
      <p style="font-size: 1.2em; font-weight: bold;">
        <strong>Total à payer :</strong> {{ total_reel }} Ar
      </p>
    </div>

    <button type="submit">Valider l'achat</button>
  </form>
</div>