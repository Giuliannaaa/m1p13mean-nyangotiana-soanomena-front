<div class="boutique-list-container">
    <div class="list-header">
        <h1 *ngIf="isAdmin">Nos Boutiques</h1>
        <h1 *ngIf="isBoutique">Vos Boutiques</h1>
        <h1 *ngIf="isAcheteur">Boutiques</h1>
        <button *ngIf="isAdmin" routerLink="/boutiques/ajouter" class="btn-primary">Ajouter une boutique</button>
    </div>

    <!-- SEARCH & FILTERS -->
    <div class="glass-card filters-container">
        <div class="filters-header">
            <div class="search-group">
                <svg xmlns="http://www.w3.org/2000/svg" class="search-icon" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd"
                        d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                        clip-rule="evenodd" />
                </svg>
                <input type="text" [(ngModel)]="searchText" (keyup)="filterBoutiques()"
                    placeholder="Rechercher une boutique par nom..." class="search-input" id="search-input" />
            </div>

            <div class="filters-actions">
                <select [(ngModel)]="filtre_special" (change)="filterBoutiques()" class="filter-select">
                    <option value="tous">Tout voir</option>
                    <option value="nouveau">Nouveautés</option>
                    <option value="populaire">Populaires</option>
                    <option value="featured">En vedette</option>
                    <option value="top-rated">Mieux notées</option>
                </select>

                <select [(ngModel)]="categorie_selectionnee" (change)="filterBoutiques()" class="filter-select">
                    <option value="">Toutes catégories</option>
                    <option *ngFor="let categorie of categories" [value]="categorie._id">
                        {{ categorie.nom_cat }}
                    </option>
                </select>

                <button (click)="resetFilter()" class="btn-icon-reset" title="Réinitialiser">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- Active Filter Indicator -->
        <div class="results-bar" *ngIf="searchText || isFiltering || isLoadingSpecial">
            <span class="result-count">
                {{ filteredBoutiques.length }} résultat(s)
            </span>
            <span class="active-filter-tag" *ngIf="searchText">
                Recherche: "{{ searchText }}"
            </span>
        </div>
    </div>

    <!-- Message si aucune boutique -->
    <div *ngIf="filteredBoutiques.length === 0" style="text-align: center; padding: 40px;">
        <p style="font-size: 16px; color: #666;">
            {{ isFiltering || searchText ? 'Aucune boutique correspondant à votre recherche' : 'Aucune boutique
            disponible' }}
        </p>
    </div>

    <!-- Tableau des boutiques -->
    <div class="glass-card overflow-hidden" *ngIf="filteredBoutiques.length > 0">
        <table class="modern-table">
            <thead>
                <tr>
                    <th>Nom</th>
                    <th>Catégorie</th>
                    <th>Propriétaire</th>
                    <th>Description</th>
                    <th>Statut</th>
                    <th *ngIf="isAdmin || isAcheteur">Actions</th>
                </tr>
            </thead>

            <tbody>
                @for (boutique of filteredBoutiques; track boutique._id) {
                <tr>
                    <td class="font-bold">
                        <a [routerLink]="['/boutiques', boutique._id]" style="color: #007bff; text-decoration: none;">
                            {{ boutique.name }}
                        </a>
                    </td>
                    <td>{{ getCategoryName(boutique.categoryId) }}</td>
                    <td>{{ getOwnerName(boutique.ownerId) }}</td>
                    <td class="td-desc">{{ boutique.description || 'Pas de description' }}</td>
                    <td>
                        <span class="badge" [ngClass]="boutique.isValidated ? 'badge-success' : 'badge-danger'">
                            {{ boutique.isValidated ? 'Validée' : 'En attente' }}
                        </span>
                    </td>
                    <td class="actions-cell">
                        <button (click)="viewBoutique(boutique._id)" class="btn-icon btn-view" title="Voir">
                            <img src="/img/svg/icon-eye.svg" alt="Voir">
                        </button>
                        <button [routerLink]="['/boutiques/modifier', boutique._id]" class="btn-icon" title="Modifier"
                            *ngIf="isAdmin">
                            <img src="/img/svg/icon-update.svg" alt="Modifier">
                        </button>
                        <button (click)="deleteBoutique(boutique._id)" class="btn-icon btn-delete" title="Supprimer"
                            *ngIf="isAdmin">
                            <img src="/img/svg/icon-delete.svg" alt="Supprimer">
                        </button>
                        <button (click)="validateBoutique(boutique._id, boutique.isValidated)" class="btn-icon"
                            *ngIf="isAdmin" [title]="boutique.isValidated ? 'Désactiver' : 'Activer'">
                            @if (boutique.isValidated) {
                            <img src="/img/svg/icon-on.svg" alt="Désactiver">
                            } @else {
                            <img src="/img/svg/icon-off.svg" alt="Activer">
                            }
                        </button>

                        <!-- Bouton Suivre pour les acheteurs -->
                        @if (isAcheteur) {
                        <button (click)="toggleSuivreBoutique(boutique._id)"
                            [style.background-color]="isBoutiqueSuivie(boutique._id) ? '#28a745' : '#007bff'"
                            [title]="isBoutiqueSuivie(boutique._id) ? 'Arrêter de suivre' : 'Suivre cette boutique'"
                            style="
                                padding: 4px 12px;
                                color: white;
                                border: none;
                                border-radius: 4px;
                                font-size: 12px;
                                cursor: pointer;
                                font-weight: bold;
                                transition: background-color 0.3s;
                                white-space: nowrap;
                            ">
                            {{ isBoutiqueSuivie(boutique._id) ? 'Suivi(e)' : '+ Suivre' }}
                        </button>
                        }
                    </td>
                </tr>
                } @empty {
                <tr>
                    <td colspan="6" class="text-center p-4">Aucune boutique disponible.</td>
                </tr>
                }
            </tbody>
        </table>
    </div>
</div>