<div class="boutique-form-container">
    <div class="glass-card form-card">
        <h1>Modifier la boutique</h1>
        <form #boutiqueForm="ngForm" (ngSubmit)="updateBoutique()" class="modern-form">

            <div class="form-group">
                <label for="name">Nom de la boutique</label>
                <input type="text" id="name" name="name" [(ngModel)]="boutique.name" class="form-control" required>
            </div>

            <div class="form-group">
                <label for="categoryId">Cat√©gorie</label>
                <select id="categoryId" name="categoryId" [(ngModel)]="boutique.categoryId" class="form-control"
                    required>
                    <option value="" disabled>S√©lectionnez une cat√©gorie</option>
                    @for (cat of categories; track cat._id) {
                    <option [value]="cat._id">{{ cat.nom_cat }}</option>
                    }
                </select>
            </div>

            <div class="form-group">
                <label for="ownerId">Propri√©taire (Boutique)</label>
                <select id="ownerId" name="ownerId" [(ngModel)]="boutique.ownerId" class="form-control" required>
                    <option value="" disabled>S√©lectionnez un propri√©taire</option>
                    @for (user of users; track user._id) {
                    <option [value]="user._id">{{ user.firstname }} {{ user.lastname }} ({{ user.email }})</option>
                    }
                </select>
            </div>

            <div class="form-group">
                <label for="description">Description</label>
                <textarea id="description" name="description" [(ngModel)]="boutique.description" class="form-control"
                    rows="4"></textarea>
            </div>

            <!-- <div class="form-section">
                <h3>Informations L√©gales</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="nif">NIF</label>
                        <input type="text" id="nif" name="nif" [(ngModel)]="boutique.legal.nif" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="stat">STAT</label>
                        <input type="text" id="stat" name="stat" [(ngModel)]="boutique.legal.stat" class="form-control">
                    </div>
                </div>
                <div class="form-group" style="margin-top: 1rem;">
                    <label for="rent">RENT (Patente/Loyer)</label>
                    <input type="text" id="rent" name="rent" [(ngModel)]="boutique.legal.rent" class="form-control">
                </div>
            </div> -->

            <div class="form-group">
                <label>Image(s) actuelle(s)</label>
                <div class="image-previews-grid mb-3">
                    @for (img of boutique.images; track img._id) {
                    <div class="preview-item existing">
                        <img [src]="getImageUrl(img.url)" alt="Image boutique" class="img-preview">
                        <button type="button" class="btn-remove" (click)="deleteExistingImage(img._id)">√ó</button>
                    </div>
                    } @empty {
                    <p class="text-muted">Aucune image pour cette boutique.</p>
                    }
                </div>
            </div>

            <div class="form-group">
                <label for="images">Ajouter des image(s)</label>
                <div class="file-input-wrapper">
                    <input type="file" id="images" (change)="onImageSelected($event)" class="file-input" multiple />
                    <div class="file-input-label">
                        <span>üìÅ Choisir des images</span>
                    </div>
                </div>

                <!-- Aper√ßu des nouvelles images -->
                @if (previews.length > 0) {
                <div>
                    <label for="">Image(s) ajout√©e(s)</label>
                    @if (previews.length > 0) {
                    <div class="image-previews-grid mt-1">
                        @for (preview of previews; track preview; let i = $index) {
                        <div class="preview-item">
                            <img [src]="preview" alt="Pr√©visualisation" class="img-preview">
                            <button type="button" class="btn-remove" (click)="removeNewImage(i)">√ó</button>
                        </div>
                        }
                    </div>
                    }
                </div>
                }
            </div>

            <div class="form-actions">
                <button type="button" routerLink="/boutiques" class="btn-secondary">Annuler</button>
                <button type="submit" [disabled]="boutiqueForm.invalid" class="btn-primary">Enregistrer les
                    modifications</button>
            </div>
        </form>
    </div>
</div>