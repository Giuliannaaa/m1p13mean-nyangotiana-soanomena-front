<div class="user-list-container">
    <div class="list-header">
        <h1>Gestion des Utilisateurs</h1>
    </div>

    <div class="filter-bar glass-card">
        <div class="search-box">
            <input type="text" [(ngModel)]="searchTerm" (input)="applyFilter()"
                placeholder="Rechercher par nom, email...">
        </div>
        <div class="filter-group">
            <label for="role-filter">Filtrer par rôle:</label>
            <select id="role-filter" [(ngModel)]="roleFilter" (change)="applyFilter()">
                <option value="all">Tous les rôles</option>
                <option value="Boutique">Boutique</option>
                <option value="Acheteur">Acheteur</option>
                <option value="Admin">Admin</option>
            </select>
        </div>
    </div>

    <div class="glass-card overflow-hidden">
        <div *ngIf="isLoading" class="loading-state">
            Chargement des utilisateurs...
        </div>

        <table class="modern-table" *ngIf="!isLoading">
            <thead>
                <tr>
                    <th>Nom</th>
                    <th>Email</th>
                    <th>Rôle</th>
                    <th>Date d'inscription</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                @for (user of filteredUsers; track user._id) {
                <tr>
                    <td class="font-bold">{{ user.firstname }} {{ user.lastname }}</td>
                    <td>{{ user.email }}</td>
                    <td>
                        <span class="role-badge" [ngClass]="'role-' + user.role?.toLowerCase()">
                            {{ user.role }}
                        </span>
                    </td>
                    <td>{{ user.createdAt | date:'dd/MM/yyyy' }}</td>
                    <td>
                        <button class="action-btn" (click)="updateUserState(user._id!)">
                            <img *ngIf="user.isActive" src="/img/svg/icon-off.svg" [alt]="'desactivate' + user._id"
                                title="Désactiver">
                            <img *ngIf="!user.isActive" src="/img/svg/icon-on.svg" [alt]="'activate' + user._id"
                                title="Activer">
                        </button>
                    </td>
                </tr>
                }
                @if (filteredUsers.length === 0) {
                <tr>
                    <td colspan="5" class="empty-state">Aucun utilisateur trouvé</td>
                </tr>
                }
            </tbody>
        </table>
    </div>
</div>