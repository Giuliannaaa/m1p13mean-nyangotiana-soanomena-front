<div class="dashboard-container">
    <div class="dashboard-header">
        <h1 class="dashboard-title">
            <span class="card-icon">
                <img src="img/svg/icon-store.svg" alt="Tableau de Bord Boutique" class="icon-img">
            </span>
            Tableau de Bord Boutique
        </h1>
        <p class="dashboard-subtitle">Statistiques de votre boutique</p>
    </div>

    <div *ngIf="loading" class="loading-container">
        <div class="spinner"></div>
        <p>Chargement...</p>
    </div>

    <div *ngIf="error" class="error-container">
        <span class="error-icon">⚠️</span>
        <p>{{ error }}</p>
    </div>

    <div *ngIf="!loading && !error">
        <!-- KPI Cards Grid -->
        <div class="stats-grid">
            <div class="stat-card products-card">
                <div class="card-icon">
                    <img src="img/svg/icon-bag.svg" alt="Produits" class="card-icon-img">
                </div>
                <div class="card-content">
                    <h3>Produits Total</h3>
                    <div class="value">{{ numberOfProducts }}</div>
                    <p class="card-label">dans vos boutiques</p>
                </div>
            </div>

            <div class="stat-card stock-card" [class.alert-card]="outOfStockCount > 0">
                <div class="card-icon">
                    <img src="img/svg/icon-empty-stock.svg" alt="Rupture de Stock" class="card-icon-img">
                </div>
                <div class="card-content">
                    <h3>Rupture de Stock</h3>
                    <div class="value" [class.alert-value]="outOfStockCount > 0">{{ outOfStockCount }}</div>
                    <p class="card-label">{{ outOfStockCount > 0 ? 'produits à réapprovisionner' : 'aucun produit en
                        rupture' }}</p>
                </div>
            </div>

            <div class="stat-card promo-card">
                <div class="card-icon">
                    <img src="img/svg/icon-gift.svg" alt="Promotions" class="card-icon-img">
                </div>
                <div class="card-content">
                    <h3>Promotions Actives</h3>
                    <div class="value">{{ activePromotionsCount }}</div>
                    <p class="card-label">{{ activePromotionsCount > 0 ? 'promotions en cours' : 'aucune promotion
                        active' }}</p>
                </div>
            </div>
        </div>

        <div class="section-card">
            <div class="section-header">
                <span class="section-icon">
                    <img src="img/svg/icon-favorite.svg" alt="Produits les Plus Vendus" class="section-icon-img">
                </span>
                <h2>Produits les Plus Vendus</h2>
            </div>

            <div *ngIf="topSellingProducts.length === 0" class="empty-state">
                <p>Aucune vente enregistrée pour le moment.</p>
            </div>

            <div *ngIf="topSellingProducts.length > 0" class="top-products-list">
                <div *ngFor="let product of topSellingProducts; let i = index" class="product-item">
                    <div class="product-rank" [class]="'rank-' + (i + 1)">{{ i + 1 }}</div>
                    <div class="product-image-wrapper">
                        <img [src]="product.image_url ? ('http://localhost:5000/' + product.image_url) : 'img/png/elementor-placeholder-image.png'"
                            [alt]="product.nom_prod" class="product-thumb" />
                    </div>
                    <div class="product-info">
                        <span class="product-name">{{ product.nom_prod }}</span>
                        <span class="product-revenue">{{ product.totalRevenue | number:'1.0-0' }} Ar</span>
                    </div>
                    <div class="product-qty">
                        <span class="qty-value">{{ product.totalQuantity }}</span>
                        <span class="qty-label">vendus</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>